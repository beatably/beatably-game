@tailwind base;
@tailwind components;
@tailwind utilities;

/* Google Fonts Custom Classes */
.chewy-regular {
  font-family: "Chewy", system-ui;
  font-weight: 400;
  font-style: normal;
}

.encode-sans-thin {
  font-family: "Encode Sans", sans-serif;
  font-optical-sizing: auto;
  font-weight: 100;
  font-style: normal;
  font-variation-settings: "wdth" 100;
}

.encode-sans-light {
  font-family: "Encode Sans", sans-serif;
  font-optical-sizing: auto;
  font-weight: 300;
  font-style: normal;
  font-variation-settings: "wdth" 100;
}

.encode-sans-regular {
  font-family: "Encode Sans", sans-serif;
  font-optical-sizing: auto;
  font-weight: 400;
  font-style: normal;
  font-variation-settings: "wdth" 100;
}

.encode-sans-medium {
  font-family: "Encode Sans", sans-serif;
  font-optical-sizing: auto;
  font-weight: 500;
  font-style: normal;
  font-variation-settings: "wdth" 100;
}

.encode-sans-semibold {
  font-family: "Encode Sans", sans-serif;
  font-optical-sizing: auto;
  font-weight: 600;
  font-style: normal;
  font-variation-settings: "wdth" 100;
}

.encode-sans-bold {
  font-family: "Encode Sans", sans-serif;
  font-optical-sizing: auto;
  font-weight: 700;
  font-style: normal;
  font-variation-settings: "wdth" 100;
}

.encode-sans-extrabold {
  font-family: "Encode Sans", sans-serif;
  font-optical-sizing: auto;
  font-weight: 800;
  font-style: normal;
  font-variation-settings: "wdth" 100;
}

.encode-sans-black {
  font-family: "Encode Sans", sans-serif;
  font-optical-sizing: auto;
  font-weight: 900;
  font-style: normal;
  font-variation-settings: "wdth" 100;
}

:root {
  font-family: "Encode Sans", sans-serif;
  line-height: 1.5;
  background-color: #121212;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover {
  color: #535bf2;
}

body {
  margin: 0;
  /* Removed display: flex and place-items: center to prevent unwanted whitespace and centering */
  min-width: 320px;
  min-height: 100vh;
  min-height: 100dvh; /* Dynamic viewport height */
  min-height: calc(var(--vh, 1vh) * 100); /* Fallback with custom property */
  
  /* Prevent Safari toolbar from affecting layout */
  position: relative;
  overflow-x: hidden;
}

h1 {
  font-size: 3.2em;
  line-height: 1.1;
}

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a1a1a;
  cursor: pointer;
  transition: border-color 0.25s;
}
button:hover {
  border-color: #646cff;
}


@media (prefers-color-scheme: light) {
  :root {
    color: #213547;
    background-color: #ffffff;
  }
  a:hover {
    color: #747bff;
  }

}

/* Prevent white overscroll flash on iOS when rubber-banding (match root background to app background) */
html, body, #root {
  background: hsl(var(--background));
  background-color: hsl(var(--background));
  /* Hard fallback to ensure webview/backdrop uses the dark surface */
  background-color: #121212 !important;
  
  /* Dynamic viewport height for mobile Safari toolbar handling */
  height: 100%;
  min-height: 100vh;
  min-height: 100dvh; /* Dynamic viewport height */
  min-height: calc(var(--vh, 1vh) * 100); /* Fallback with custom property */
  
  background-attachment: fixed;
  overscroll-behavior-y: contain;
  -webkit-overflow-scrolling: touch;
}

/* Safe area handling - BROWSER MODE ONLY */
@media (display-mode: browser) {
  html, body, #root {
    /* Safe area handling for devices with notches in browser mode */
    padding-top: env(safe-area-inset-top);
    padding-right: env(safe-area-inset-right);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
  }
}

/* PWA STANDALONE MODE - No global padding, components handle their own safe areas */
@media (display-mode: standalone) {
  html, body, #root {
    /* Remove global safe area padding in PWA mode */
    padding: 0;
    /* Fix iOS grab handle area background to black */
    background-color: #000000 !important;
  }
  
  /* Ensure the grab handle area at bottom is black for landing page */
  body::after {
    content: '';
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: env(safe-area-inset-bottom, 0px);
    background-color: #000000;
    z-index: 9999;
    pointer-events: none;
  }
  
  /* Waiting room specific safe area background using body class */
  body.waiting-room-active::after {
    content: '';
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: env(safe-area-inset-bottom, 0px);
    background-color: hsl(var(--background)) !important;
    z-index: 10000;
    pointer-events: none;
  }
  
}

/* Ensure smooth native scrolling on iOS (kept for older engines) */
html, body {
  -webkit-overflow-scrolling: touch;
}

/* Mobile Safari and touch improvements */
* {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Mobile Safari toolbar minimization utilities */
.mobile-fullscreen {
  height: 100vh;
  height: 100dvh; /* Dynamic viewport height */
  height: calc(var(--vh, 1vh) * 100); /* Fallback with custom property */
  width: 100vw;
  width: 100dvw; /* Dynamic viewport width */
  overflow: hidden;
}

.mobile-safe-area {
  padding-top: env(safe-area-inset-top);
  padding-right: env(safe-area-inset-right);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
}

.mobile-safe-area-top {
  padding-top: env(safe-area-inset-top);
}

.mobile-safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}

/* Prevent Safari address bar from affecting fixed elements */
.mobile-fixed-top {
  position: fixed;
  top: 0;
  top: env(safe-area-inset-top);
  left: 0;
  right: 0;
  z-index: 1000;
}

.mobile-fixed-bottom {
  position: fixed;
  bottom: 0;
  bottom: env(safe-area-inset-bottom);
  left: 0;
  right: 0;
  z-index: 1000;
}

/* iOS Safari specific fixes */
@supports (-webkit-touch-callout: none) {
  .ios-viewport-fix {
    min-height: -webkit-fill-available;
  }
  
  /* Prevent zoom on input focus */
  input, select, textarea {
    font-size: 16px !important;
  }
  
  /* Prevent rubber band scrolling */
  body {
    overscroll-behavior: none;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Virtual keyboard handling for iOS PWA */
  @media (display-mode: standalone) {
    /* When virtual keyboard is active, adjust layout */
    .landing-container {
      /* Use keyboard-inset-height when available */
      padding-bottom: max(1rem, env(keyboard-inset-height, env(safe-area-inset-bottom))) !important;
      
      /* Keep bottom alignment but allow scrolling when keyboard appears */
      justify-content: flex-end !important;
      
      /* Allow scrolling when keyboard is active */
      overflow-y: auto !important;
    }
    
    /* Specific keyboard handling for different devices */
    @media screen and (max-width: 414px) {
      .landing-container {
        /* Reduce spacing when keyboard might be active */
        gap: 0.5rem;
      }
      
      .landing-container .space-y-3 > * + * {
        margin-top: 0.5rem !important;
      }
      
      .landing-container .space-y-4 > * + * {
        margin-top: 0.75rem !important;
      }
    }
  }
  
  /* Landing page specific iOS fixes */
  .landing-container {
    /* Force hardware acceleration for smoother scrolling */
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
    
    /* Prevent content from extending beyond viewport */
    contain: layout style paint;
    
    /* Additional overflow protection for iOS */
    overflow-x: hidden;
    overflow-y: hidden;
  }
  
  
  /* Browser mode - keep existing behavior */
  @media (display-mode: browser) {
    .landing-container {
      /* Browser mode: minimal padding since global CSS handles safe areas */
      padding-top: 0.5rem !important;
      padding-bottom: max(0.75rem, env(safe-area-inset-bottom)) !important;
    }
    
    @media screen and (max-width: 390px) and (max-height: 844px) {
      .landing-container {
        padding-top: 0.5rem !important;
        padding-bottom: max(0.75rem, env(safe-area-inset-bottom)) !important;
      }
    }
  }
}


/* Allow text selection for inputs and text areas */
input, textarea, [contenteditable] {
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}

/* Drop zone active state for touch dragging */
.drop-zone-active {
  background-color: #4f46e5 !important;
  border-color: #6366f1 !important;
  transform: scale(1.1) !important;
  box-shadow: 0 0 20px rgba(79, 70, 229, 0.5) !important;
}

/* Improve touch targets for mobile */
@media (max-width: 768px) {
  button {
    min-height: 44px;
    min-width: 44px;
    padding: 0.8em 1.4em;
  }
  
  /* Larger touch targets for draggable cards */
  [data-draggable="true"] {
    min-height: 60px;
    min-width: 60px;
  }
  
  /* Better spacing for drop zones on mobile */
  [data-drop-zone="true"] {
    min-height: 40px;
    margin: 4px 0;
  }
}

/* Prevent scrolling during drag operations */
body.dragging {
  overflow: hidden;
  position: fixed;
  width: 100%;
}

/* Safari-specific audio improvements */
audio {
  -webkit-playsinline: true;
  playsinline: true;
}

/* Smooth animations for better mobile performance */
.smooth-animation {
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
}

/* Mobile-first custom animations */
@layer components {
  .touch-button {
    @apply transition-all duration-200 ease-out;
  }
  
  .touch-button:active {
    @apply scale-95;
  }
  
  .interactive-card {
    @apply transition-all duration-300 ease-out;
  }
  
  .interactive-card:hover {
    @apply -translate-y-1 shadow-2xl;
  }
  
  .spotify-gradient {
    background: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(142 76% 42%) 100%);
  }
  
  .purple-gradient {
    background: linear-gradient(135deg, hsl(var(--secondary)) 0%, hsl(262 83% 65%) 100%);
  }
  
  .mobile-shadow {
    box-shadow: 
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06),
      0 0 0 1px rgba(255, 255, 255, 0.05);
  }
  
  .glow-green {
    box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
  }
  
  .glow-purple {
    box-shadow: 0 0 20px rgba(147, 51, 234, 0.3);
  }
  
  /* Visual hierarchy improvements */
  .setting-button {
    @apply rounded-md; /* Smaller radius for buttons */
  }
  
  .container-card {
    @apply rounded-xl; /* Larger radius for containers */
  }

  /* Inline link-style button used for compact page-level actions (Reset, Clear, etc.)
     Keeps visual footprint minimal while preserving a 44×44px touch area via padding tricks.
     Use this class instead of relying on <button> defaults for inline actions. */
  .inline-link-button {
    @apply text-foreground underline font-semibold text-sm p-2 -m-2 flex items-center gap-2 hover:text-foreground/80 focus:outline-none bg-transparent border-0 rounded-none appearance-none;
  }
  
  .warning-card {
    @apply rounded-lg border-l-4; /* Left border accent for warnings */
  }

  /* COMPREHENSIVE BUTTON FOCUS AND STYLE OVERRIDE */
  
  /* Target all buttons globally */
  button,
  button:focus,
  button:focus-visible,
  button:active,
  [role="button"],
  [role="button"]:focus,
  [role="button"]:focus-visible,
  [role="button"]:active {
    -webkit-tap-highlight-color: transparent !important;
    -webkit-focus-ring-color: transparent !important;
  }
  
  /* Remove persistent focus outline after mobile tap for all buttons */
  button:focus:not(:focus-visible),
  [role="button"]:focus:not(:focus-visible) {
    outline: none !important;
    box-shadow: none !important;
  }
  
  /* SHADCN/UI BUTTON COMPONENT OVERRIDES */
  
  /* Remove the focus ring completely from all button variants */
  button:focus-visible,
  button.focus-visible\:ring-2:focus-visible,
  [role="button"]:focus-visible {
    outline: none !important;
    box-shadow: none !important;
    ring: none !important;
    --tw-ring-shadow: none !important;
    --tw-ring-offset-shadow: none !important;
  }
  
  /* Override outline variant background to be transparent */
  button[class*="border"][class*="bg-background"],
  .outline-button-override {
    background-color: transparent !important;
    border-color: hsl(var(--border)) !important;
  }
  
  /* Ensure hover states work properly for outline buttons */
  button[class*="border"][class*="bg-background"]:hover,
  .outline-button-override:hover {
    background-color: hsl(var(--input)) !important;
  }
  
  /* Targeted focus outline removal for specific buttons that have persistent purple outline issues */
  .no-focus-outline {
    -webkit-tap-highlight-color: transparent !important;
    -webkit-focus-ring-color: transparent !important;
  }
  
  /* Only remove focus outline on touch end to prevent persistent highlights after mobile tap */
  .no-focus-outline:focus:not(:focus-visible) {
    outline: none !important;
    box-shadow: none !important;
  }
  
  /* For buttons that specifically need all focus styles removed (play/pause/restart buttons) */
  .no-focus-outline.force-no-outline,
  .no-focus-outline.force-no-outline:focus,
  .no-focus-outline.force-no-outline:focus-visible,
  .no-focus-outline.force-no-outline:active {
    outline: none !important;
    box-shadow: none !important;
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    appearance: none !important;
  }
}

@layer base {
  :root {
    /* Dark theme as default for mobile-first design */
    --background: 0 0% 7%;
    --foreground: 0 0% 98%;
    --card: 0 0% 12%;
    --card-foreground: 0 0% 98%;
    --popover: 0 0% 12%;
    --popover-foreground: 0 0% 98%;
    --primary: 142 76% 36%; /* Spotify Green */
    --primary-foreground: 0 0% 98%;
    --secondary: 262 83% 58%; /* Purple accent */
    --secondary-foreground: 0 0% 98%;
    --muted: 0 0% 20%;
    --muted-foreground: 0 0% 63.9%;
    --accent: 262 83% 58%; /* Purple accent */
    --accent-foreground: 0 0% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 20%;
    --input: 0 0% 15%;
    --ring: 142 76% 36%; /* Spotify Green for focus rings */
    --chart-1: 142 76% 36%;
    --chart-2: 262 83% 58%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --radius: 0.75rem; /* Larger radius for mobile */
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}
